# MASTER AUDIT PROMPT - Story Portal Platform v2

## AUTONOMOUS EXECUTION DIRECTIVE

You are executing a comprehensive platform audit. Run this AUTONOMOUSLY from start to finish without stopping for confirmation. Save all outputs to files as you go. If a check fails, document it and continue.

**Working Directory:** The directory where this prompt was invoked (should be `story-portal-app-v2/`)
**Output Directory:** `./audit/` (create if not exists)
**Total Agents:** 37 (V2 Platform - complete audit across all layers)
**Estimated Duration:** 5-7 hours

---

## CRITICAL: STANDARDIZED THREE-TIER OUTPUT STRUCTURE

**ALL 37 agents MUST produce both findings AND reports following this structure:**

### Tier 1: Raw Data (Findings)
**Location:** `./audit/findings/AUD-XXX-name.md`
**Purpose:** Machine-readable data collection
**Content:** Command outputs, query results, raw evidence

### Tier 2: Detailed Analysis (Reports)
**Location:** `./audit/reports/AUD-XXX-name-report.md`
**Purpose:** Human-readable structured analysis
**Required Template:**

```markdown
# [Agent Name] - Detailed Analysis Report

**Agent ID:** AUD-XXX
**Category:** [Infrastructure/Security/Data/API/Quality/Production]
**Generated:** [Timestamp]

## Summary
[2-3 sentence overview]

## Priority & Risk
- **Priority:** P1/P2/P3/P4
- **Risk Level:** Critical/High/Medium/Low
- **Urgency:** Immediate/Short-term/Medium-term/Long-term

## Key Findings
1. [Finding 1]
2. [Finding 2]
3. [Finding 3]

## Evidence
- Reference: `./audit/findings/AUD-XXX-name.md` Section [X]

## Impact Analysis
[What this means for platform]

## Recommendations
1. **[Action 1]** (Effort: X days, Priority: PX)
2. **[Action 2]** (Effort: X days, Priority: PX)

## Dependencies
- Requires: [prerequisites]
- Blocks: [blocked tasks]
```

### Tier 3: Consolidated Summaries
**Generated by:** AUD-001 Orchestrator in Phase 7
**Location:** `./audit/consolidated/`

---

## PHASE 0: INITIALIZATION

### Step 0.1: Create Output Directories

```bash
mkdir -p ./audit/{findings,reports,checkpoints,evidence,logs,consolidated}
echo "Audit started at $(date)" > ./audit/logs/audit.log
```

### Step 0.2: Record System State

```bash
echo "=== SYSTEM STATE ===" > ./audit/checkpoints/initial-state.txt
echo "Date: $(date)" >> ./audit/checkpoints/initial-state.txt
echo "Working Directory: $(pwd)" >> ./audit/checkpoints/initial-state.txt
echo "User: $(whoami)" >> ./audit/checkpoints/initial-state.txt
docker ps -a >> ./audit/checkpoints/initial-state.txt 2>&1 || echo "Docker not available"
```

### Step 0.3: Verify Platform Repository

```bash
if [ -d "./platform" ]; then
  echo "Platform directory found" >> ./audit/logs/audit.log
  ls -la ./platform/ > ./audit/checkpoints/platform-structure.txt
else
  echo "ERROR: Platform directory not found" >> ./audit/logs/audit.log
  echo "ERROR: Run this from story-portal-app-v2 root directory"
fi
```

---

## PHASE 1: INFRASTRUCTURE DISCOVERY

Execute these checks and save results. Continue even if individual checks fail.

### AUD-019: Docker/Container Infrastructure

**Execute:**
```bash
echo "=== AUD-019: Docker Infrastructure Audit ===" | tee ./audit/logs/AUD-019.log

# Container Inventory
echo "## Container Inventory" > ./audit/findings/AUD-019-docker.md
docker ps -a --format "table {{.Names}}\t{{.Image}}\t{{.Status}}\t{{.Ports}}" >> ./audit/findings/AUD-019-docker.md 2>&1

# Resource Limits
echo "## Resource Limits" >> ./audit/findings/AUD-019-docker.md
docker ps -q | xargs -I {} docker inspect --format='{{.Name}}: Memory={{.HostConfig.Memory}} CPU={{.HostConfig.NanoCpus}}' {} >> ./audit/findings/AUD-019-docker.md 2>&1

# Image Versions
echo "## Image Versions" >> ./audit/findings/AUD-019-docker.md
docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}" >> ./audit/findings/AUD-019-docker.md 2>&1

# Volume Mounts
echo "## Volumes" >> ./audit/findings/AUD-019-docker.md
docker ps -q | xargs -I {} docker inspect --format='{{.Name}}: {{range .Mounts}}{{.Source}}->{{.Destination}} {{end}}' {} >> ./audit/findings/AUD-019-docker.md 2>&1

# Network Configuration
echo "## Networks" >> ./audit/findings/AUD-019-docker.md
docker network ls >> ./audit/findings/AUD-019-docker.md 2>&1

# Docker Compose Validation
echo "## Compose Validation" >> ./audit/findings/AUD-019-docker.md
docker-compose config --quiet && echo "VALID" >> ./audit/findings/AUD-019-docker.md || echo "INVALID or NOT FOUND" >> ./audit/findings/AUD-019-docker.md
```

**Analyze findings and create report:** `./audit/reports/AUD-019-container-infrastructure.md`

---

### AUD-020: LLM/Model Inventory

**Execute:**
```bash
echo "=== AUD-020: LLM Model Audit ===" | tee ./audit/logs/AUD-020.log

echo "## Model List" > ./audit/findings/AUD-020-llm.md
curl -s http://localhost:11434/api/tags 2>/dev/null | python3 -c "
import json, sys
try:
    data = json.load(sys.stdin)
    for m in data.get('models', []):
        print(f\"- {m['name']}: {m.get('size', 'unknown')} bytes\")
except:
    print('Ollama not available or no models')
" >> ./audit/findings/AUD-020-llm.md

echo "## Model Details" >> ./audit/findings/AUD-020-llm.md
curl -s http://localhost:11434/api/tags 2>/dev/null | python3 -c "
import json, sys
try:
    data = json.load(sys.stdin)
    for m in data.get('models', []):
        print(f\"### {m['name']}\")
        print(f\"Modified: {m.get('modified_at', 'unknown')}\")
        print(f\"Size: {m.get('size', 'unknown')}\")
        print()
except:
    print('Could not retrieve model details')
" >> ./audit/findings/AUD-020-llm.md

# GPU Check
echo "## GPU Status" >> ./audit/findings/AUD-020-llm.md
nvidia-smi --query-gpu=name,memory.used,memory.total --format=csv 2>/dev/null >> ./audit/findings/AUD-020-llm.md || echo "No NVIDIA GPU detected" >> ./audit/findings/AUD-020-llm.md
```

**Analyze findings and create report:** `./audit/reports/AUD-020-llm-inventory.md`

---

### AUD-021: PostgreSQL Deep Configuration

**Execute:**
```bash
echo "=== AUD-021: PostgreSQL Deep Audit ===" | tee ./audit/logs/AUD-021.log

echo "## PostgreSQL Configuration" > ./audit/findings/AUD-021-postgres.md

# Connection Test
echo "### Connection Test" >> ./audit/findings/AUD-021-postgres.md
pg_isready -h localhost -p 5432 >> ./audit/findings/AUD-021-postgres.md 2>&1

# Extensions
echo "### Extensions" >> ./audit/findings/AUD-021-postgres.md
PGPASSWORD=postgres psql -h localhost -U postgres -d agentic -c "SELECT extname, extversion FROM pg_extension;" >> ./audit/findings/AUD-021-postgres.md 2>&1

# Database Size
echo "### Database Size" >> ./audit/findings/AUD-021-postgres.md
PGPASSWORD=postgres psql -h localhost -U postgres -d agentic -c "SELECT pg_size_pretty(pg_database_size('agentic'));" >> ./audit/findings/AUD-021-postgres.md 2>&1

# Table Sizes
echo "### Table Sizes" >> ./audit/findings/AUD-021-postgres.md
PGPASSWORD=postgres psql -h localhost -U postgres -d agentic -c "SELECT schemaname, tablename, pg_size_pretty(pg_total_relation_size(schemaname || '.' || tablename)) as size FROM pg_tables WHERE schemaname='public' ORDER BY pg_total_relation_size(schemaname || '.' || tablename) DESC LIMIT 20;" >> ./audit/findings/AUD-021-postgres.md 2>&1

# Connection Count
echo "### Active Connections" >> ./audit/findings/AUD-021-postgres.md
PGPASSWORD=postgres psql -h localhost -U postgres -c "SELECT count(*) as connections FROM pg_stat_activity;" >> ./audit/findings/AUD-021-postgres.md 2>&1

# Check for pgvector
echo "### pgvector Status" >> ./audit/findings/AUD-021-postgres.md
PGPASSWORD=postgres psql -h localhost -U postgres -d agentic -c "SELECT extversion FROM pg_extension WHERE extname='vector';" >> ./audit/findings/AUD-021-postgres.md 2>&1 || echo "pgvector NOT installed" >> ./audit/findings/AUD-021-postgres.md
```

**Analyze findings and create report:** `./audit/reports/AUD-021-postgresql-deep.md`

---

## PHASE 2: SERVICE DISCOVERY

### AUD-010: Service Health Discovery

**Execute:**
```bash
echo "=== AUD-010: Service Discovery ===" | tee ./audit/logs/AUD-010.log

cat > ./audit/findings/AUD-010-services.md << 'EOF'
# Service Discovery Findings

## Infrastructure Services
EOF

# PostgreSQL
echo "### PostgreSQL (5432)" >> ./audit/findings/AUD-010-services.md
pg_isready -h localhost -p 5432 >> ./audit/findings/AUD-010-services.md 2>&1 && echo "Status: RUNNING" >> ./audit/findings/AUD-010-services.md || echo "Status: NOT AVAILABLE" >> ./audit/findings/AUD-010-services.md

# Redis
echo "### Redis (6379)" >> ./audit/findings/AUD-010-services.md
redis-cli ping >> ./audit/findings/AUD-010-services.md 2>&1 && echo "Status: RUNNING" >> ./audit/findings/AUD-010-services.md || echo "Status: NOT AVAILABLE" >> ./audit/findings/AUD-010-services.md

# Ollama
echo "### Ollama (11434)" >> ./audit/findings/AUD-010-services.md
curl -s http://localhost:11434/api/version >> ./audit/findings/AUD-010-services.md 2>&1 && echo "Status: RUNNING" >> ./audit/findings/AUD-010-services.md || echo "Status: NOT AVAILABLE" >> ./audit/findings/AUD-010-services.md

# Application Layers
echo "## Application Layer Health" >> ./audit/findings/AUD-010-services.md
for port in 8001 8002 8003 8004 8005 8006 8007 8008 8009 8010 8011 8012; do
  echo "### Port $port" >> ./audit/findings/AUD-010-services.md
  response=$(curl -s -w "\nHTTP_CODE:%{http_code}" http://localhost:$port/health 2>/dev/null)
  if [ $? -eq 0 ]; then
    echo "$response" >> ./audit/findings/AUD-010-services.md
  else
    echo "NOT RESPONDING" >> ./audit/findings/AUD-010-services.md
  fi
done

# MCP Services (PM2)
echo "## MCP Services (PM2)" >> ./audit/findings/AUD-010-services.md
pm2 list >> ./audit/findings/AUD-010-services.md 2>&1 || echo "PM2 not available" >> ./audit/findings/AUD-010-services.md
```

**Create structured JSON:**
```bash
cat > ./audit/findings/AUD-010-findings.json << 'EOF'
{
  "agent": "AUD-010",
  "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
  "category": "service-discovery",
  "services_checked": []
}
EOF
```

**Analyze findings and create report:** `./audit/reports/AUD-010-service-discovery.md`

---

### AUD-011: CLI Tooling Audit

**Execute:**
```bash
echo "=== AUD-011: CLI Tooling Audit ===" | tee ./audit/logs/AUD-011.log

echo "# CLI Tooling Audit" > ./audit/findings/AUD-011-cli.md

# Check each layer for CLI entry points
cd ./platform/src 2>/dev/null || cd ./platform 2>/dev/null || echo "Platform not found"

echo "## Layer CLI Status" >> ../../audit/findings/AUD-011-cli.md 2>/dev/null || echo "## Layer CLI Status" >> ./audit/findings/AUD-011-cli.md

for layer in L01_data_layer L02_runtime L03_tool_execution L04_model_gateway L05_planning L06_evaluation L07_learning L09_api_gateway L10_human_interface L11_integration; do
  echo "### $layer" >> ../../audit/findings/AUD-011-cli.md 2>/dev/null || echo "### $layer" >> ./audit/findings/AUD-011-cli.md
  if [ -d "$layer" ]; then
    # Check for __main__.py
    if [ -f "$layer/__main__.py" ]; then
      echo "- CLI Entry Point: YES (__main__.py)" 
    else
      echo "- CLI Entry Point: NO"
    fi
    # Check for CLI module
    if [ -f "$layer/cli.py" ]; then
      echo "- CLI Module: YES (cli.py)"
    else
      echo "- CLI Module: NO"
    fi
    # Try to get help
    python -m $layer --help 2>&1 | head -5 || echo "- Cannot execute"
  else
    echo "- Directory: NOT FOUND"
  fi >> ../../audit/findings/AUD-011-cli.md 2>/dev/null || >> ./audit/findings/AUD-011-cli.md
done

cd - > /dev/null 2>&1
```

**Analyze findings and create report:** `./audit/reports/AUD-011-cli-tooling.md`

---

### AUD-012: MCP Service Audit

**Execute:**
```bash
echo "=== AUD-012: MCP Service Audit ===" | tee ./audit/logs/AUD-012.log

echo "# MCP Service Audit" > ./audit/findings/AUD-012-mcp.md

# PM2 Status
echo "## PM2 Process Status" >> ./audit/findings/AUD-012-mcp.md
pm2 jlist 2>/dev/null | python3 -c "
import json, sys
try:
    data = json.load(sys.stdin)
    for p in data:
        print(f\"- {p['name']}: {p['pm2_env']['status']} (pid: {p.get('pid', 'N/A')})\")
except:
    print('PM2 not available')
" >> ./audit/findings/AUD-012-mcp.md

# MCP Config Files
echo "## MCP Configuration Files" >> ./audit/findings/AUD-012-mcp.md
find . -name "*.mcp.json" -o -name "mcp*.json" 2>/dev/null | head -20 >> ./audit/findings/AUD-012-mcp.md
find . -name "mcp-config*" 2>/dev/null | head -20 >> ./audit/findings/AUD-012-mcp.md

# Tool Definitions
echo "## Tool Definitions Found" >> ./audit/findings/AUD-012-mcp.md
grep -r "\"tools\"" --include="*.json" ./platform 2>/dev/null | head -20 >> ./audit/findings/AUD-012-mcp.md
```

**Analyze findings and create report:** `./audit/reports/AUD-012-mcp-services.md`

---

### AUD-013: Configuration Audit

**Execute:**
```bash
echo "=== AUD-013: Configuration Audit ===" | tee ./audit/logs/AUD-013.log

echo "# Configuration Audit" > ./audit/findings/AUD-013-config.md

# Environment Files
echo "## Environment Files" >> ./audit/findings/AUD-013-config.md
find . -name ".env*" -type f 2>/dev/null | head -20 >> ./audit/findings/AUD-013-config.md

# Count env vars (without exposing values)
echo "## Environment Variables (count per file)" >> ./audit/findings/AUD-013-config.md
for f in $(find . -name ".env*" -type f 2>/dev/null | head -10); do
  count=$(grep -c "=" "$f" 2>/dev/null || echo 0)
  echo "- $f: $count variables" >> ./audit/findings/AUD-013-config.md
done

# Config YAML/JSON files
echo "## Configuration Files" >> ./audit/findings/AUD-013-config.md
find ./platform -name "config*.yaml" -o -name "config*.json" -o -name "settings*.yaml" 2>/dev/null | head -20 >> ./audit/findings/AUD-013-config.md

# Check for sensitive patterns (without exposing)
echo "## Sensitive Pattern Detection" >> ./audit/findings/AUD-013-config.md
grep -r "API_KEY\|SECRET\|PASSWORD\|TOKEN" --include=".env*" . 2>/dev/null | wc -l | xargs -I {} echo "Found {} lines with sensitive patterns" >> ./audit/findings/AUD-013-config.md
```

**Analyze findings and create report:** `./audit/reports/AUD-013-configuration.md`

---

## PHASE 2.5: V2 PLATFORM COMPONENTS

### AUD-025: L09 API Gateway Enhanced Audit

**Execute:**
```bash
echo "=== AUD-025: L09 API Gateway Audit ===" | tee ./audit/logs/AUD-025.log

echo "# L09 API Gateway Audit" > ./audit/findings/AUD-025-l09-gateway.md

# Health Check
echo "## Health Check" >> ./audit/findings/AUD-025-l09-gateway.md
curl -s http://localhost:8009/health/live >> ./audit/findings/AUD-025-l09-gateway.md 2>&1

# Gateway Configuration
echo "## Gateway Configuration" >> ./audit/findings/AUD-025-l09-gateway.md
docker exec l09-api-gateway cat /app/config.yaml 2>/dev/null >> ./audit/findings/AUD-025-l09-gateway.md || echo "Config not accessible" >> ./audit/findings/AUD-025-l09-gateway.md

# Rate Limiting Test
echo "## Rate Limiting" >> ./audit/findings/AUD-025-l09-gateway.md
for i in {1..5}; do
  response=$(curl -s -w "\nHTTP_CODE:%{http_code}" http://localhost:8009/health/live 2>&1)
  echo "Request $i: $response" >> ./audit/findings/AUD-025-l09-gateway.md
done

# CORS Configuration
echo "## CORS Configuration" >> ./audit/findings/AUD-025-l09-gateway.md
curl -s -H "Origin: http://localhost:3000" -I http://localhost:8009/health/live 2>&1 | grep -i "access-control" >> ./audit/findings/AUD-025-l09-gateway.md

# Route Discovery
echo "## Available Routes" >> ./audit/findings/AUD-025-l09-gateway.md
curl -s http://localhost:8009/routes 2>&1 >> ./audit/findings/AUD-025-l09-gateway.md || echo "Route discovery not available" >> ./audit/findings/AUD-025-l09-gateway.md

# Proxy to Backend Services
echo "## Backend Service Routing" >> ./audit/findings/AUD-025-l09-gateway.md
for port in 8001 8002 8003 8004 8005 8006 8007 8010 8011 8012; do
  echo "### Testing proxy to port $port" >> ./audit/findings/AUD-025-l09-gateway.md
  curl -s -w "\nStatus: %{http_code}" http://localhost:8009/api/l$(printf "%02d" $((port-8000)))/health 2>&1 | head -3 >> ./audit/findings/AUD-025-l09-gateway.md
done

# Authentication Middleware
echo "## Authentication" >> ./audit/findings/AUD-025-l09-gateway.md
grep -r "authenticate\|jwt\|bearer" ./platform/src/L09_api_gateway 2>/dev/null | wc -l | xargs -I {} echo "Found {} auth-related code lines" >> ./audit/findings/AUD-025-l09-gateway.md

# Error Handling
echo "## Error Handling" >> ./audit/findings/AUD-025-l09-gateway.md
curl -s http://localhost:8009/nonexistent 2>&1 | head -10 >> ./audit/findings/AUD-025-l09-gateway.md
```

**Analyze findings and create report:** `./audit/reports/AUD-025-l09-gateway.md`

---

### AUD-026: L12 Service Hub Audit

**Execute:**
```bash
echo "=== AUD-026: L12 Service Hub Audit ===" | tee ./audit/logs/AUD-026.log

echo "# L12 Service Hub Audit" > ./audit/findings/AUD-026-l12-service-hub.md

# Health Check
echo "## Health Check" >> ./audit/findings/AUD-026-l12-service-hub.md
curl -s http://localhost:8012/health >> ./audit/findings/AUD-026-l12-service-hub.md 2>&1

# Service Discovery
echo "## Service Discovery" >> ./audit/findings/AUD-026-l12-service-hub.md
curl -s http://localhost:8012/api/v1/services 2>&1 | python3 -c "
import json, sys
try:
    data = json.load(sys.stdin)
    services = data.get('services', [])
    print(f'Total services: {len(services)}')
    for svc in services[:10]:
        print(f\"- {svc.get('name', 'unknown')}: {svc.get('layer', 'unknown')} - {svc.get('description', 'no description')[:60]}\")
    if len(services) > 10:
        print(f'... and {len(services) - 10} more services')
except Exception as e:
    print(f'Error parsing services: {e}')
" >> ./audit/findings/AUD-026-l12-service-hub.md

# Fuzzy Search Test
echo "## Fuzzy Search" >> ./audit/findings/AUD-026-l12-service-hub.md
for query in "agent" "event" "config" "runtime" "tool"; do
  echo "### Search: '$query'" >> ./audit/findings/AUD-026-l12-service-hub.md
  curl -s "http://localhost:8012/api/v1/services/search?q=$query" 2>&1 | python3 -c "
import json, sys
try:
    data = json.load(sys.stdin)
    results = data.get('results', [])
    print(f'Found {len(results)} results')
    for r in results[:3]:
        print(f\"- {r.get('name', 'unknown')} (score: {r.get('score', 0):.2f})\")
except:
    print('Search failed')
" >> ./audit/findings/AUD-026-l12-service-hub.md
done

# Service Invocation
echo "## Service Invocation" >> ./audit/findings/AUD-026-l12-service-hub.md
curl -s -X POST http://localhost:8012/api/v1/services/invoke \
  -H "Content-Type: application/json" \
  -d '{"service_name":"AgentRegistry","method":"list_agents","params":{}}' 2>&1 | head -20 >> ./audit/findings/AUD-026-l12-service-hub.md

# Workflow Execution
echo "## Workflow Execution" >> ./audit/findings/AUD-026-l12-service-hub.md
curl -s http://localhost:8012/api/v1/workflows 2>&1 | head -20 >> ./audit/findings/AUD-026-l12-service-hub.md

# Session Management
echo "## Session Management" >> ./audit/findings/AUD-026-l12-service-hub.md
curl -s -X POST http://localhost:8012/api/v1/sessions -H "Content-Type: application/json" -d '{"user_id":"audit-test"}' 2>&1 | head -10 >> ./audit/findings/AUD-026-l12-service-hub.md

# Code Quality
echo "## Code Quality" >> ./audit/findings/AUD-026-l12-service-hub.md
find ./platform/src/L12_nl_interface_layer -name "*.py" 2>/dev/null | wc -l | xargs -I {} echo "Python files: {}" >> ./audit/findings/AUD-026-l12-service-hub.md
grep -r "def " ./platform/src/L12_nl_interface_layer 2>/dev/null | wc -l | xargs -I {} echo "Functions: {}" >> ./audit/findings/AUD-026-l12-service-hub.md
```

**Analyze findings and create report:** `./audit/reports/AUD-026-l12-service-hub.md`

---

### AUD-027: Platform Control Center UI Audit

**Execute:**
```bash
echo "=== AUD-027: Platform Control Center UI Audit ===" | tee ./audit/logs/AUD-027.log

echo "# Platform Control Center UI Audit" > ./audit/findings/AUD-027-platform-ui.md

# HTTP Accessibility
echo "## HTTP Accessibility" >> ./audit/findings/AUD-027-platform-ui.md
curl -s -w "HTTP Status: %{http_code}\nResponse Time: %{time_total}s\n" http://localhost:3000/ -o /dev/null >> ./audit/findings/AUD-027-platform-ui.md 2>&1

# HTML Structure
echo "## HTML Structure" >> ./audit/findings/AUD-027-platform-ui.md
curl -s http://localhost:3000/ 2>&1 | head -30 >> ./audit/findings/AUD-027-platform-ui.md

# Route Testing
echo "## Route Testing" >> ./audit/findings/AUD-027-platform-ui.md
for route in "" "dashboard" "agents" "services" "workflows" "goals" "monitoring"; do
  status=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/$route 2>&1)
  echo "/$route: HTTP $status" >> ./audit/findings/AUD-027-platform-ui.md
done

# Static Assets
echo "## Static Assets" >> ./audit/findings/AUD-027-platform-ui.md
docker exec platform-ui ls -lh /usr/share/nginx/html/assets/ 2>/dev/null | head -20 >> ./audit/findings/AUD-027-platform-ui.md || echo "Assets directory not accessible" >> ./audit/findings/AUD-027-platform-ui.md

# Bundle Size
echo "## Bundle Size" >> ./audit/findings/AUD-027-platform-ui.md
docker exec platform-ui du -sh /usr/share/nginx/html/assets/*.js 2>/dev/null >> ./audit/findings/AUD-027-platform-ui.md || echo "Bundle files not found" >> ./audit/findings/AUD-027-platform-ui.md

# Build Artifacts
echo "## Build Artifacts" >> ./audit/findings/AUD-027-platform-ui.md
ls -lh ./platform/ui/platform-control-center/dist/ 2>/dev/null | head -10 >> ./audit/findings/AUD-027-platform-ui.md || echo "Dist directory not found" >> ./audit/findings/AUD-027-platform-ui.md

# TypeScript/React Files
echo "## Source Code" >> ./audit/findings/AUD-027-platform-ui.md
find ./platform/ui/platform-control-center/src -name "*.tsx" -o -name "*.ts" 2>/dev/null | wc -l | xargs -I {} echo "TypeScript files: {}" >> ./audit/findings/AUD-027-platform-ui.md
find ./platform/ui/platform-control-center/src -name "*.css" 2>/dev/null | wc -l | xargs -I {} echo "CSS files: {}" >> ./audit/findings/AUD-027-platform-ui.md

# Package Dependencies
echo "## Dependencies" >> ./audit/findings/AUD-027-platform-ui.md
cat ./platform/ui/platform-control-center/package.json 2>/dev/null | python3 -c "
import json, sys
try:
    pkg = json.load(sys.stdin)
    deps = pkg.get('dependencies', {})
    devDeps = pkg.get('devDependencies', {})
    print(f'Dependencies: {len(deps)}')
    print(f'DevDependencies: {len(devDeps)}')
    print(f'React version: {deps.get(\"react\", \"not found\")}')
    print(f'TypeScript version: {devDeps.get(\"typescript\", \"not found\")}')
except:
    print('package.json not readable')
" >> ./audit/findings/AUD-027-platform-ui.md
```

**Analyze findings and create report:** `./audit/reports/AUD-027-platform-ui.md`

---

### AUD-028: nginx Configuration Audit

**Execute:**
```bash
echo "=== AUD-028: nginx Configuration Audit ===" | tee ./audit/logs/AUD-028.log

echo "# nginx Configuration Audit" > ./audit/findings/AUD-028-nginx.md

# nginx Version
echo "## nginx Version" >> ./audit/findings/AUD-028-nginx.md
docker exec platform-ui nginx -v 2>&1 >> ./audit/findings/AUD-028-nginx.md

# Configuration File
echo "## Configuration File" >> ./audit/findings/AUD-028-nginx.md
docker exec platform-ui cat /etc/nginx/conf.d/default.conf 2>/dev/null >> ./audit/findings/AUD-028-nginx.md || echo "Config not accessible" >> ./audit/findings/AUD-028-nginx.md

# Configuration Test
echo "## Configuration Test" >> ./audit/findings/AUD-028-nginx.md
docker exec platform-ui nginx -t 2>&1 >> ./audit/findings/AUD-028-nginx.md

# Reverse Proxy to API Gateway
echo "## API Gateway Proxy" >> ./audit/findings/AUD-028-nginx.md
curl -s -w "\nStatus: %{http_code}\n" http://localhost:3000/api/health 2>&1 | head -10 >> ./audit/findings/AUD-028-nginx.md

# Reverse Proxy to L12 Service Hub
echo "## Service Hub Proxy" >> ./audit/findings/AUD-028-nginx.md
curl -s -w "\nStatus: %{http_code}\n" http://localhost:3000/services/health 2>&1 | head -10 >> ./audit/findings/AUD-028-nginx.md

# WebSocket Proxy Configuration
echo "## WebSocket Configuration" >> ./audit/findings/AUD-028-nginx.md
docker exec platform-ui grep -A 5 "upgrade" /etc/nginx/conf.d/default.conf 2>/dev/null >> ./audit/findings/AUD-028-nginx.md || echo "WebSocket config not found" >> ./audit/findings/AUD-028-nginx.md

# Security Headers
echo "## Security Headers" >> ./audit/findings/AUD-028-nginx.md
curl -s -I http://localhost:3000/ 2>&1 | grep -i "x-\|content-security\|strict-transport" >> ./audit/findings/AUD-028-nginx.md

# Gzip Compression
echo "## Gzip Compression" >> ./audit/findings/AUD-028-nginx.md
curl -s -H "Accept-Encoding: gzip" -I http://localhost:3000/ 2>&1 | grep -i "content-encoding" >> ./audit/findings/AUD-028-nginx.md

# Error Pages
echo "## Error Page Handling" >> ./audit/findings/AUD-028-nginx.md
curl -s http://localhost:3000/nonexistent 2>&1 | head -20 >> ./audit/findings/AUD-028-nginx.md
```

**Analyze findings and create report:** `./audit/reports/AUD-028-nginx-config.md`

---

### AUD-029: UI-Backend Integration Audit

**Execute:**
```bash
echo "=== AUD-029: UI-Backend Integration Audit ===" | tee ./audit/logs/AUD-029.log

echo "# UI-Backend Integration Audit" > ./audit/findings/AUD-029-ui-backend.md

# API Client Configuration
echo "## API Client Configuration" >> ./audit/findings/AUD-029-ui-backend.md
grep -r "axios\|fetch\|http" ./platform/ui/platform-control-center/src/services 2>/dev/null | head -10 >> ./audit/findings/AUD-029-ui-backend.md

# API Endpoint Tests
echo "## API Endpoint Tests" >> ./audit/findings/AUD-029-ui-backend.md
for endpoint in "/api/agents" "/api/services" "/api/workflows" "/api/goals"; do
  echo "### $endpoint" >> ./audit/findings/AUD-029-ui-backend.md
  curl -s -w "\nStatus: %{http_code}\n" "http://localhost:8009$endpoint" 2>&1 | head -5 >> ./audit/findings/AUD-029-ui-backend.md
done

# WebSocket Connection
echo "## WebSocket Connection" >> ./audit/findings/AUD-029-ui-backend.md
cat ./platform/ui/platform-control-center/src/services/websocket.ts 2>/dev/null | grep -A 3 "new WebSocket\|io(" | head -10 >> ./audit/findings/AUD-029-ui-backend.md

# Environment Configuration
echo "## Environment Configuration" >> ./audit/findings/AUD-029-ui-backend.md
cat ./platform/ui/platform-control-center/.env 2>/dev/null | grep -v "^#" >> ./audit/findings/AUD-029-ui-backend.md || echo "No .env file found" >> ./audit/findings/AUD-029-ui-backend.md

# CORS Verification
echo "## CORS Verification" >> ./audit/findings/AUD-029-ui-backend.md
curl -s -H "Origin: http://localhost:3000" -H "Access-Control-Request-Method: POST" -H "Access-Control-Request-Headers: Content-Type" -X OPTIONS http://localhost:8009/api/agents 2>&1 | grep -i "access-control" >> ./audit/findings/AUD-029-ui-backend.md

# Error Handling
echo "## Error Handling" >> ./audit/findings/AUD-029-ui-backend.md
grep -r "try.*catch\|\.catch\|onError" ./platform/ui/platform-control-center/src/services 2>/dev/null | wc -l | xargs -I {} echo "Error handlers found: {}" >> ./audit/findings/AUD-029-ui-backend.md

# Real-time Events
echo "## Real-time Events" >> ./audit/findings/AUD-029-ui-backend.md
grep -r "socket.on\|addEventListener\|subscribe" ./platform/ui/platform-control-center/src 2>/dev/null | wc -l | xargs -I {} echo "Event listeners found: {}" >> ./audit/findings/AUD-029-ui-backend.md
```

**Analyze findings and create report:** `./audit/reports/AUD-029-ui-backend-integration.md`

---

### AUD-030: Documentation Completeness & Accuracy Audit

**Execute:**
```bash
echo "=== AUD-030: Documentation Audit ===" | tee ./audit/logs/AUD-030.log

echo "# Documentation Completeness & Accuracy Audit" > ./audit/findings/AUD-030-documentation.md

# USER_GUIDE.md Audit
echo "## USER_GUIDE.md" >> ./audit/findings/AUD-030-documentation.md
if [ -f "./platform/docs/USER_GUIDE.md" ]; then
  wc -l ./platform/docs/USER_GUIDE.md | xargs -I {} echo "Lines: {}" >> ./audit/findings/AUD-030-documentation.md
  grep "^#" ./platform/docs/USER_GUIDE.md | wc -l | xargs -I {} echo "Sections: {}" >> ./audit/findings/AUD-030-documentation.md
  grep -c "http\|localhost" ./platform/docs/USER_GUIDE.md | xargs -I {} echo "URLs/Commands: {}" >> ./audit/findings/AUD-030-documentation.md
else
  echo "USER_GUIDE.md not found" >> ./audit/findings/AUD-030-documentation.md
fi

# API_REFERENCE.md Audit
echo "## API_REFERENCE.md" >> ./audit/findings/AUD-030-documentation.md
if [ -f "./platform/docs/API_REFERENCE.md" ]; then
  wc -l ./platform/docs/API_REFERENCE.md | xargs -I {} echo "Lines: {}" >> ./audit/findings/AUD-030-documentation.md
  grep "^###" ./platform/docs/API_REFERENCE.md | wc -l | xargs -I {} echo "API endpoints documented: {}" >> ./audit/findings/AUD-030-documentation.md
  grep -c "GET\|POST\|PUT\|DELETE\|PATCH" ./platform/docs/API_REFERENCE.md | xargs -I {} echo "HTTP methods: {}" >> ./audit/findings/AUD-030-documentation.md
else
  echo "API_REFERENCE.md not found" >> ./audit/findings/AUD-030-documentation.md
fi

# DEPLOYMENT_COMPLETE.md Audit
echo "## DEPLOYMENT_COMPLETE.md" >> ./audit/findings/AUD-030-documentation.md
if [ -f "./platform/DEPLOYMENT_COMPLETE.md" ]; then
  wc -l ./platform/DEPLOYMENT_COMPLETE.md | xargs -I {} echo "Lines: {}" >> ./audit/findings/AUD-030-documentation.md
  grep -c "L0[0-9]\|L1[0-2]" ./platform/DEPLOYMENT_COMPLETE.md | xargs -I {} echo "Layer references: {}" >> ./audit/findings/AUD-030-documentation.md
else
  echo "DEPLOYMENT_COMPLETE.md not found" >> ./audit/findings/AUD-030-documentation.md
fi

# PHASE_4_COMPLETE.md Audit
echo "## PHASE_4_COMPLETE.md" >> ./audit/findings/AUD-030-documentation.md
if [ -f "./platform/PHASE_4_COMPLETE.md" ]; then
  wc -l ./platform/PHASE_4_COMPLETE.md | xargs -I {} echo "Lines: {}" >> ./audit/findings/AUD-030-documentation.md
else
  echo "PHASE_4_COMPLETE.md not found" >> ./audit/findings/AUD-030-documentation.md
fi

# Link Validation
echo "## Link Validation" >> ./audit/findings/AUD-030-documentation.md
for doc in ./platform/docs/USER_GUIDE.md ./platform/docs/API_REFERENCE.md ./platform/DEPLOYMENT_COMPLETE.md; do
  if [ -f "$doc" ]; then
    echo "### $(basename $doc)" >> ./audit/findings/AUD-030-documentation.md
    grep -o "http://localhost:[0-9]*" "$doc" 2>/dev/null | sort -u | while read url; do
      status=$(curl -s -o /dev/null -w "%{http_code}" "$url" 2>&1)
      echo "$url: HTTP $status" >> ./audit/findings/AUD-030-documentation.md
    done
  fi
done

# Command Validation
echo "## Command Validation" >> ./audit/findings/AUD-030-documentation.md
echo "Extracting commands from documentation..." >> ./audit/findings/AUD-030-documentation.md
grep -h '```bash' ./platform/docs/*.md 2>/dev/null | wc -l | xargs -I {} echo "Bash code blocks: {}" >> ./audit/findings/AUD-030-documentation.md

# README Files
echo "## README Files" >> ./audit/findings/AUD-030-documentation.md
find ./platform -name "README.md" 2>/dev/null | while read readme; do
  echo "- $readme ($(wc -l < "$readme") lines)" >> ./audit/findings/AUD-030-documentation.md
done
```

**Analyze findings and create report:** `./audit/reports/AUD-030-documentation.md`

---

## PHASE 3: SECURITY & COMPLIANCE

### AUD-002: Security Audit

**Execute:**
```bash
echo "=== AUD-002: Security Audit ===" | tee ./audit/logs/AUD-002.log

echo "# Security Audit" > ./audit/findings/AUD-002-security.md

# Authentication Patterns
echo "## Authentication Patterns" >> ./audit/findings/AUD-002-security.md
grep -r "jwt\|oauth\|bearer\|api.key\|authenticate" --include="*.py" ./platform 2>/dev/null | wc -l | xargs -I {} echo "Found {} auth-related code lines" >> ./audit/findings/AUD-002-security.md

# Authorization Patterns
echo "## Authorization Patterns" >> ./audit/findings/AUD-002-security.md
grep -r "permission\|authorize\|rbac\|abac\|policy" --include="*.py" ./platform 2>/dev/null | wc -l | xargs -I {} echo "Found {} authz-related code lines" >> ./audit/findings/AUD-002-security.md

# Input Validation
echo "## Input Validation" >> ./audit/findings/AUD-002-security.md
grep -r "pydantic\|validator\|validate\|sanitize" --include="*.py" ./platform 2>/dev/null | wc -l | xargs -I {} echo "Found {} validation-related code lines" >> ./audit/findings/AUD-002-security.md

# Hardcoded Secrets (pattern only, not values)
echo "## Potential Hardcoded Secrets" >> ./audit/findings/AUD-002-security.md
grep -rn "password\s*=\s*['\"]" --include="*.py" ./platform 2>/dev/null | wc -l | xargs -I {} echo "Found {} potential hardcoded passwords" >> ./audit/findings/AUD-002-security.md

# SQL Injection Patterns
echo "## SQL Patterns" >> ./audit/findings/AUD-002-security.md
grep -rn "execute\|raw_sql\|text(" --include="*.py" ./platform 2>/dev/null | wc -l | xargs -I {} echo "Found {} raw SQL patterns (review needed)" >> ./audit/findings/AUD-002-security.md

# CORS Configuration
echo "## CORS Configuration" >> ./audit/findings/AUD-002-security.md
grep -rn "CORSMiddleware\|allow_origins" --include="*.py" ./platform 2>/dev/null >> ./audit/findings/AUD-002-security.md
```

**Analyze findings and create report:** `./audit/reports/AUD-002-security.md`

---

### AUD-014: Token Management Audit

**Execute:**
```bash
echo "=== AUD-014: Token Management Audit ===" | tee ./audit/logs/AUD-014.log

echo "# Token Management Audit" > ./audit/findings/AUD-014-tokens.md

# JWT Configuration
echo "## JWT Patterns" >> ./audit/findings/AUD-014-tokens.md
grep -rn "jwt\|JWT\|JsonWebToken" --include="*.py" ./platform 2>/dev/null | head -30 >> ./audit/findings/AUD-014-tokens.md

# API Key Patterns
echo "## API Key Patterns" >> ./audit/findings/AUD-014-tokens.md
grep -rn "api.key\|apikey\|x-api-key" --include="*.py" ./platform 2>/dev/null | head -30 >> ./audit/findings/AUD-014-tokens.md

# Session Management
echo "## Session Patterns" >> ./audit/findings/AUD-014-tokens.md
grep -rn "session\|Session" --include="*.py" ./platform 2>/dev/null | head -30 >> ./audit/findings/AUD-014-tokens.md

# LLM Token Tracking
echo "## LLM Token Tracking" >> ./audit/findings/AUD-014-tokens.md
grep -rn "token_count\|usage\|prompt_tokens\|completion_tokens" --include="*.py" ./platform 2>/dev/null | head -30 >> ./audit/findings/AUD-014-tokens.md
```

**Analyze findings and create report:** `./audit/reports/AUD-014-token-management.md`

---

### AUD-023: Network/TLS Audit

**Execute:**
```bash
echo "=== AUD-023: Network/TLS Audit ===" | tee ./audit/logs/AUD-023.log

echo "# Network/TLS Audit" > ./audit/findings/AUD-023-network.md

# TLS Certificates
echo "## TLS Certificates" >> ./audit/findings/AUD-023-network.md
find . -name "*.pem" -o -name "*.crt" -o -name "*.key" 2>/dev/null | head -20 >> ./audit/findings/AUD-023-network.md
if [ $(find . -name "*.crt" 2>/dev/null | wc -l) -eq 0 ]; then
  echo "No TLS certificates found" >> ./audit/findings/AUD-023-network.md
fi

# Internal HTTPS
echo "## Internal HTTPS Usage" >> ./audit/findings/AUD-023-network.md
grep -rn "https://localhost\|https://127.0.0.1" --include="*.py" ./platform 2>/dev/null | wc -l | xargs -I {} echo "Found {} internal HTTPS references" >> ./audit/findings/AUD-023-network.md

# Exposed Ports
echo "## Exposed Docker Ports" >> ./audit/findings/AUD-023-network.md
docker ps --format "{{.Names}}: {{.Ports}}" 2>/dev/null >> ./audit/findings/AUD-023-network.md
```

**Analyze findings and create report:** `./audit/reports/AUD-023-network-tls.md`

---

### AUD-024: Backup/Recovery Audit

**Execute:**
```bash
echo "=== AUD-024: Backup/Recovery Audit ===" | tee ./audit/logs/AUD-024.log

echo "# Backup/Recovery Audit" > ./audit/findings/AUD-024-backup.md

# Backup Scripts
echo "## Backup Scripts" >> ./audit/findings/AUD-024-backup.md
find . -name "*backup*" -type f 2>/dev/null | head -20 >> ./audit/findings/AUD-024-backup.md
find . -name "*dump*" -type f 2>/dev/null | head -20 >> ./audit/findings/AUD-024-backup.md

# Redis Persistence
echo "## Redis Persistence" >> ./audit/findings/AUD-024-backup.md
redis-cli CONFIG GET save 2>/dev/null >> ./audit/findings/AUD-024-backup.md || echo "Redis not available" >> ./audit/findings/AUD-024-backup.md
redis-cli LASTSAVE 2>/dev/null >> ./audit/findings/AUD-024-backup.md

# PostgreSQL Backup Test
echo "## PostgreSQL Backup Capability" >> ./audit/findings/AUD-024-backup.md
which pg_dump >> ./audit/findings/AUD-024-backup.md 2>&1 && echo "pg_dump: AVAILABLE" >> ./audit/findings/AUD-024-backup.md || echo "pg_dump: NOT FOUND" >> ./audit/findings/AUD-024-backup.md
```

**Analyze findings and create report:** `./audit/reports/AUD-024-backup-recovery.md`

---

## PHASE 4: DATA & STATE

### AUD-004: Database Schema Audit

**Execute:**
```bash
echo "=== AUD-004: Database Schema Audit ===" | tee ./audit/logs/AUD-004.log

echo "# Database Schema Audit" > ./audit/findings/AUD-004-database.md

# List Tables
echo "## Tables" >> ./audit/findings/AUD-004-database.md
PGPASSWORD=postgres psql -h localhost -U postgres -d agentic -c "\dt" >> ./audit/findings/AUD-004-database.md 2>&1

# List Indexes
echo "## Indexes" >> ./audit/findings/AUD-004-database.md
PGPASSWORD=postgres psql -h localhost -U postgres -d agentic -c "\di" >> ./audit/findings/AUD-004-database.md 2>&1

# Foreign Keys
echo "## Foreign Key Constraints" >> ./audit/findings/AUD-004-database.md
PGPASSWORD=postgres psql -h localhost -U postgres -d agentic -c "SELECT conname, conrelid::regclass, confrelid::regclass FROM pg_constraint WHERE contype = 'f';" >> ./audit/findings/AUD-004-database.md 2>&1

# Check Constraints
echo "## Check Constraints" >> ./audit/findings/AUD-004-database.md
PGPASSWORD=postgres psql -h localhost -U postgres -d agentic -c "SELECT conname, conrelid::regclass FROM pg_constraint WHERE contype = 'c';" >> ./audit/findings/AUD-004-database.md 2>&1

# Schema Definition Files
echo "## Schema Files in Codebase" >> ./audit/findings/AUD-004-database.md
find ./platform -name "*schema*" -o -name "*migration*" -o -name "models.py" 2>/dev/null | head -30 >> ./audit/findings/AUD-004-database.md
```

**Analyze findings and create report:** `./audit/reports/AUD-004-database-schema.md`

---

### AUD-015: Redis State Audit

**Execute:**
```bash
echo "=== AUD-015: Redis State Audit ===" | tee ./audit/logs/AUD-015.log

echo "# Redis State Audit" > ./audit/findings/AUD-015-redis.md

# Redis Info
echo "## Redis Info" >> ./audit/findings/AUD-015-redis.md
redis-cli INFO server 2>/dev/null | head -20 >> ./audit/findings/AUD-015-redis.md

# Key Patterns
echo "## Key Patterns" >> ./audit/findings/AUD-015-redis.md
redis-cli KEYS "*" 2>/dev/null | head -50 >> ./audit/findings/AUD-015-redis.md

# Key Count by Pattern
echo "## Key Statistics" >> ./audit/findings/AUD-015-redis.md
redis-cli DBSIZE 2>/dev/null >> ./audit/findings/AUD-015-redis.md

# Memory Usage
echo "## Memory Usage" >> ./audit/findings/AUD-015-redis.md
redis-cli INFO memory 2>/dev/null | grep -E "used_memory|maxmemory" >> ./audit/findings/AUD-015-redis.md

# Pub/Sub Channels
echo "## Pub/Sub Channels" >> ./audit/findings/AUD-015-redis.md
redis-cli PUBSUB CHANNELS "*" 2>/dev/null >> ./audit/findings/AUD-015-redis.md
```

**Analyze findings and create report:** `./audit/reports/AUD-015-redis-state.md`

---

### AUD-017: Event Flow Audit

**Execute:**
```bash
echo "=== AUD-017: Event Flow Audit ===" | tee ./audit/logs/AUD-017.log

echo "# Event Flow Audit" > ./audit/findings/AUD-017-events.md

# Event Sourcing Patterns
echo "## Event Sourcing Code" >> ./audit/findings/AUD-017-events.md
grep -rn "event_store\|EventStore\|append_event\|get_events" --include="*.py" ./platform 2>/dev/null | head -30 >> ./audit/findings/AUD-017-events.md

# Event Types
echo "## Event Type Definitions" >> ./audit/findings/AUD-017-events.md
grep -rn "class.*Event\|EventType\|event_type" --include="*.py" ./platform 2>/dev/null | head -30 >> ./audit/findings/AUD-017-events.md

# CQRS Patterns
echo "## CQRS Patterns" >> ./audit/findings/AUD-017-events.md
grep -rn "Command\|Query\|CommandHandler\|QueryHandler" --include="*.py" ./platform 2>/dev/null | head -30 >> ./audit/findings/AUD-017-events.md

# Event Table
echo "## Event Table Contents (sample)" >> ./audit/findings/AUD-017-events.md
PGPASSWORD=postgres psql -h localhost -U postgres -d agentic -c "SELECT * FROM events LIMIT 5;" >> ./audit/findings/AUD-017-events.md 2>&1 || echo "No events table" >> ./audit/findings/AUD-017-events.md
```

**Analyze findings and create report:** `./audit/reports/AUD-017-event-flow.md`

---

## PHASE 5: INTEGRATION & API

### AUD-016: API Endpoint Audit

**Execute:**
```bash
echo "=== AUD-016: API Endpoint Audit ===" | tee ./audit/logs/AUD-016.log

echo "# API Endpoint Audit" > ./audit/findings/AUD-016-api.md

# FastAPI Routes
echo "## FastAPI Route Definitions" >> ./audit/findings/AUD-016-api.md
grep -rn "@app\.\|@router\." --include="*.py" ./platform 2>/dev/null | head -100 >> ./audit/findings/AUD-016-api.md

# Route Count by Method
echo "## Route Counts" >> ./audit/findings/AUD-016-api.md
echo "GET routes: $(grep -rn "@.*\.get(" --include="*.py" ./platform 2>/dev/null | wc -l)" >> ./audit/findings/AUD-016-api.md
echo "POST routes: $(grep -rn "@.*\.post(" --include="*.py" ./platform 2>/dev/null | wc -l)" >> ./audit/findings/AUD-016-api.md
echo "PUT routes: $(grep -rn "@.*\.put(" --include="*.py" ./platform 2>/dev/null | wc -l)" >> ./audit/findings/AUD-016-api.md
echo "DELETE routes: $(grep -rn "@.*\.delete(" --include="*.py" ./platform 2>/dev/null | wc -l)" >> ./audit/findings/AUD-016-api.md

# OpenAPI Specs
echo "## OpenAPI Specifications" >> ./audit/findings/AUD-016-api.md
find ./platform -name "openapi*.json" -o -name "openapi*.yaml" -o -name "swagger*" 2>/dev/null >> ./audit/findings/AUD-016-api.md

# Health Endpoints
echo "## Health Endpoints" >> ./audit/findings/AUD-016-api.md
grep -rn "/health\|/ready\|/live" --include="*.py" ./platform 2>/dev/null >> ./audit/findings/AUD-016-api.md
```

**Analyze findings and create report:** `./audit/reports/AUD-016-api-endpoints.md`

---

### AUD-005: Integration Test Audit

**Execute:**
```bash
echo "=== AUD-005: Integration Test Audit ===" | tee ./audit/logs/AUD-005.log

echo "# Integration Audit" > ./audit/findings/AUD-005-integration.md

# Cross-Layer Imports
echo "## Cross-Layer Imports" >> ./audit/findings/AUD-005-integration.md
for layer in L01 L02 L03 L04 L05 L06 L07 L09 L10 L11; do
  echo "### $layer imports:" >> ./audit/findings/AUD-005-integration.md
  grep -rn "from.*$layer\|import.*$layer" --include="*.py" ./platform 2>/dev/null | grep -v "^./platform/src/$layer" | head -10 >> ./audit/findings/AUD-005-integration.md
done

# HTTP Client Usage
echo "## HTTP Client Patterns" >> ./audit/findings/AUD-005-integration.md
grep -rn "httpx\|requests\|aiohttp\|AsyncClient" --include="*.py" ./platform 2>/dev/null | wc -l | xargs -I {} echo "Found {} HTTP client usages" >> ./audit/findings/AUD-005-integration.md

# gRPC Usage
echo "## gRPC Patterns" >> ./audit/findings/AUD-005-integration.md
grep -rn "grpc\|protobuf" --include="*.py" ./platform 2>/dev/null | wc -l | xargs -I {} echo "Found {} gRPC references" >> ./audit/findings/AUD-005-integration.md
```

**Analyze findings and create report:** `./audit/reports/AUD-005-integration.md`

---

### AUD-018: Error Handling Audit

**Execute:**
```bash
echo "=== AUD-018: Error Handling Audit ===" | tee ./audit/logs/AUD-018.log

echo "# Error Handling Audit" > ./audit/findings/AUD-018-errors.md

# Exception Classes
echo "## Custom Exception Classes" >> ./audit/findings/AUD-018-errors.md
grep -rn "class.*Exception\|class.*Error" --include="*.py" ./platform 2>/dev/null | head -50 >> ./audit/findings/AUD-018-errors.md

# Try/Except Patterns
echo "## Exception Handling Patterns" >> ./audit/findings/AUD-018-errors.md
grep -rn "except\s" --include="*.py" ./platform 2>/dev/null | wc -l | xargs -I {} echo "Found {} except clauses" >> ./audit/findings/AUD-018-errors.md

# Bare Except
echo "## Bare Except (anti-pattern)" >> ./audit/findings/AUD-018-errors.md
grep -rn "except:" --include="*.py" ./platform 2>/dev/null | head -20 >> ./audit/findings/AUD-018-errors.md

# Error Codes
echo "## Error Code Definitions" >> ./audit/findings/AUD-018-errors.md
grep -rn "E[0-9]\{4\}\|error_code\|ErrorCode" --include="*.py" ./platform 2>/dev/null | head -50 >> ./audit/findings/AUD-018-errors.md

# HTTP Error Responses
echo "## HTTP Error Responses" >> ./audit/findings/AUD-018-errors.md
grep -rn "HTTPException\|status_code=" --include="*.py" ./platform 2>/dev/null | head -30 >> ./audit/findings/AUD-018-errors.md
```

**Analyze findings and create report:** `./audit/reports/AUD-018-error-handling.md`

---

### AUD-022: Observability Audit

**Execute:**
```bash
echo "=== AUD-022: Observability Audit ===" | tee ./audit/logs/AUD-022.log

echo "# Observability Audit" > ./audit/findings/AUD-022-observability.md

# Prometheus Metrics
echo "## Prometheus Metrics" >> ./audit/findings/AUD-022-observability.md
grep -rn "prometheus\|Counter\|Gauge\|Histogram\|metrics" --include="*.py" ./platform 2>/dev/null | head -30 >> ./audit/findings/AUD-022-observability.md

# Logging Configuration
echo "## Logging Configuration" >> ./audit/findings/AUD-022-observability.md
grep -rn "logging\|structlog\|loguru" --include="*.py" ./platform 2>/dev/null | head -30 >> ./audit/findings/AUD-022-observability.md

# OpenTelemetry
echo "## OpenTelemetry" >> ./audit/findings/AUD-022-observability.md
grep -rn "opentelemetry\|otel\|tracer\|span" --include="*.py" ./platform 2>/dev/null | head -30 >> ./audit/findings/AUD-022-observability.md

# Monitoring Services
echo "## Monitoring Service Status" >> ./audit/findings/AUD-022-observability.md
curl -s http://localhost:9090/-/healthy >> ./audit/findings/AUD-022-observability.md 2>&1 && echo "Prometheus: RUNNING" >> ./audit/findings/AUD-022-observability.md || echo "Prometheus: NOT RUNNING" >> ./audit/findings/AUD-022-observability.md
curl -s http://localhost:3000/api/health >> ./audit/findings/AUD-022-observability.md 2>&1 && echo "Grafana: RUNNING" >> ./audit/findings/AUD-022-observability.md || echo "Grafana: NOT RUNNING" >> ./audit/findings/AUD-022-observability.md
```

**Analyze findings and create report:** `./audit/reports/AUD-022-observability.md`

---

### AUD-031: External Dependencies Audit

**Execute:**
```bash
echo "=== AUD-031: External Dependencies Audit ===" | tee ./audit/logs/AUD-031.log

echo "# External Dependencies Audit" > ./audit/findings/AUD-031-external.md

# Python Dependencies
echo "## Python Dependencies" >> ./audit/findings/AUD-031-external.md
cat ./platform/requirements*.txt 2>/dev/null | grep -v "^#" | head -50 >> ./audit/findings/AUD-031-external.md

# External API References
echo "## External API References" >> ./audit/findings/AUD-031-external.md
grep -rn "https://\|http://" --include="*.py" ./platform 2>/dev/null | grep -v "localhost\|127.0.0.1\|0.0.0.0" | head -30 >> ./audit/findings/AUD-031-external.md

# CI/CD Configuration
echo "## CI/CD Files" >> ./audit/findings/AUD-031-external.md
ls -la .github/workflows/ 2>/dev/null >> ./audit/findings/AUD-031-external.md || echo "No GitHub Actions found" >> ./audit/findings/AUD-031-external.md

# Package Lock Files
echo "## Lock Files" >> ./audit/findings/AUD-031-external.md
find . -name "*.lock" -o -name "package-lock.json" -o -name "poetry.lock" 2>/dev/null | head -10 >> ./audit/findings/AUD-031-external.md
```

**Analyze findings and create report:** `./audit/reports/AUD-031-external-dependencies.md`

---

## PHASE 6: QUALITY & EXPERIENCE

### AUD-003: QA/Test Coverage Audit

**Execute:**
```bash
echo "=== AUD-003: QA/Test Coverage Audit ===" | tee ./audit/logs/AUD-003.log

echo "# QA/Test Coverage Audit" > ./audit/findings/AUD-003-qa.md

# Test Files
echo "## Test Files" >> ./audit/findings/AUD-003-qa.md
find ./platform -name "test_*.py" -o -name "*_test.py" 2>/dev/null | head -50 >> ./audit/findings/AUD-003-qa.md

# Test Count
echo "## Test Function Count" >> ./audit/findings/AUD-003-qa.md
grep -rn "def test_\|async def test_" --include="*.py" ./platform 2>/dev/null | wc -l | xargs -I {} echo "Found {} test functions" >> ./audit/findings/AUD-003-qa.md

# pytest Configuration
echo "## pytest Configuration" >> ./audit/findings/AUD-003-qa.md
cat ./platform/pytest.ini 2>/dev/null >> ./audit/findings/AUD-003-qa.md || cat ./platform/pyproject.toml 2>/dev/null | grep -A20 "\[tool.pytest" >> ./audit/findings/AUD-003-qa.md || echo "No pytest config found" >> ./audit/findings/AUD-003-qa.md

# Coverage Configuration
echo "## Coverage Configuration" >> ./audit/findings/AUD-003-qa.md
cat ./platform/.coveragerc 2>/dev/null >> ./audit/findings/AUD-003-qa.md || echo "No coverage config found" >> ./audit/findings/AUD-003-qa.md
```

**Analyze findings and create report:** `./audit/reports/AUD-003-qa-coverage.md`

---

### AUD-007: Code Quality Audit

**Execute:**
```bash
echo "=== AUD-007: Code Quality Audit ===" | tee ./audit/logs/AUD-007.log

echo "# Code Quality Audit" > ./audit/findings/AUD-007-quality.md

# Type Hints
echo "## Type Hint Coverage" >> ./audit/findings/AUD-007-quality.md
grep -rn "def.*->.*:" --include="*.py" ./platform 2>/dev/null | wc -l | xargs -I {} echo "Functions with return type hints: {}" >> ./audit/findings/AUD-007-quality.md
grep -rn "def.*:$" --include="*.py" ./platform 2>/dev/null | wc -l | xargs -I {} echo "Functions without return type hints: {}" >> ./audit/findings/AUD-007-quality.md

# Docstrings
echo "## Docstring Coverage" >> ./audit/findings/AUD-007-quality.md
grep -rn '"""' --include="*.py" ./platform 2>/dev/null | wc -l | xargs -I {} echo "Docstring markers found: {}" >> ./audit/findings/AUD-007-quality.md

# TODO/FIXME
echo "## TODO/FIXME Comments" >> ./audit/findings/AUD-007-quality.md
grep -rn "TODO\|FIXME\|XXX\|HACK" --include="*.py" ./platform 2>/dev/null | head -30 >> ./audit/findings/AUD-007-quality.md

# Code Complexity (file sizes)
echo "## Large Files (>500 lines)" >> ./audit/findings/AUD-007-quality.md
find ./platform -name "*.py" -exec wc -l {} \; 2>/dev/null | awk '$1 > 500 {print}' | sort -rn | head -20 >> ./audit/findings/AUD-007-quality.md
```

**Analyze findings and create report:** `./audit/reports/AUD-007-code-quality.md`

---

### AUD-006: Performance Audit

**Execute:**
```bash
echo "=== AUD-006: Performance Audit ===" | tee ./audit/logs/AUD-006.log

echo "# Performance Audit" > ./audit/findings/AUD-006-performance.md

# Async Patterns
echo "## Async Pattern Usage" >> ./audit/findings/AUD-006-performance.md
grep -rn "async def\|await " --include="*.py" ./platform 2>/dev/null | wc -l | xargs -I {} echo "Async patterns found: {}" >> ./audit/findings/AUD-006-performance.md

# Connection Pooling
echo "## Connection Pool Configuration" >> ./audit/findings/AUD-006-performance.md
grep -rn "pool_size\|max_connections\|pool" --include="*.py" ./platform 2>/dev/null | head -20 >> ./audit/findings/AUD-006-performance.md

# Caching
echo "## Caching Patterns" >> ./audit/findings/AUD-006-performance.md
grep -rn "cache\|@cached\|lru_cache\|ttl" --include="*.py" ./platform 2>/dev/null | head -20 >> ./audit/findings/AUD-006-performance.md

# N+1 Query Risk
echo "## Potential N+1 Query Patterns" >> ./audit/findings/AUD-006-performance.md
grep -rn "for.*in.*:.*\.query\|for.*in.*select" --include="*.py" ./platform 2>/dev/null | head -20 >> ./audit/findings/AUD-006-performance.md
```

**Analyze findings and create report:** `./audit/reports/AUD-006-performance.md`

---

### AUD-008: UI/UX Audit

**Execute:**
```bash
echo "=== AUD-008: UI/UX Audit ===" | tee ./audit/logs/AUD-008.log

echo "# UI/UX Audit" > ./audit/findings/AUD-008-uiux.md

# Frontend Files
echo "## Frontend Files" >> ./audit/findings/AUD-008-uiux.md
find ./platform -name "*.html" -o -name "*.jsx" -o -name "*.tsx" -o -name "*.vue" 2>/dev/null | head -30 >> ./audit/findings/AUD-008-uiux.md

# Static Assets
echo "## Static Assets" >> ./audit/findings/AUD-008-uiux.md
find ./platform -type d -name "static" -o -name "public" -o -name "assets" 2>/dev/null >> ./audit/findings/AUD-008-uiux.md

# L10 Human Interface
echo "## L10 Human Interface Layer" >> ./audit/findings/AUD-008-uiux.md
ls -la ./platform/src/L10_human_interface/ 2>/dev/null >> ./audit/findings/AUD-008-uiux.md || echo "L10 not found" >> ./audit/findings/AUD-008-uiux.md

# Accessibility Patterns
echo "## Accessibility Patterns" >> ./audit/findings/AUD-008-uiux.md
grep -rn "aria-\|role=\|alt=" --include="*.html" --include="*.jsx" --include="*.tsx" ./platform 2>/dev/null | wc -l | xargs -I {} echo "ARIA/accessibility attributes: {}" >> ./audit/findings/AUD-008-uiux.md
```

**Analyze findings and create report:** `./audit/reports/AUD-008-uiux.md`

---

### AUD-009: Developer Experience Audit

**Execute:**
```bash
echo "=== AUD-009: Developer Experience Audit ===" | tee ./audit/logs/AUD-009.log

echo "# Developer Experience Audit" > ./audit/findings/AUD-009-devex.md

# README Files
echo "## README Files" >> ./audit/findings/AUD-009-devex.md
find ./platform -name "README*" -type f 2>/dev/null >> ./audit/findings/AUD-009-devex.md

# Documentation
echo "## Documentation Files" >> ./audit/findings/AUD-009-devex.md
find ./platform -name "*.md" -type f 2>/dev/null | wc -l | xargs -I {} echo "Markdown files: {}" >> ./audit/findings/AUD-009-devex.md

# Examples
echo "## Example Files" >> ./audit/findings/AUD-009-devex.md
find ./platform -name "*example*" -o -name "*sample*" 2>/dev/null | head -20 >> ./audit/findings/AUD-009-devex.md

# Setup Scripts
echo "## Setup Scripts" >> ./audit/findings/AUD-009-devex.md
find ./platform -name "setup*" -o -name "install*" -o -name "bootstrap*" 2>/dev/null | head -10 >> ./audit/findings/AUD-009-devex.md

# Makefile
echo "## Makefile" >> ./audit/findings/AUD-009-devex.md
cat ./platform/Makefile 2>/dev/null | head -30 >> ./audit/findings/AUD-009-devex.md || echo "No Makefile found" >> ./audit/findings/AUD-009-devex.md
```

**Analyze findings and create report:** `./audit/reports/AUD-009-devex.md`

---

## PHASE 5.7: PRODUCTION READINESS FEATURES VALIDATION

This phase validates Phase 4 & 5 deployments: monitoring stack, security hardening, performance optimization, backup/recovery, CI/CD pipeline, and HA architecture.

### AUD-032: Monitoring Stack Validation

**Execute:**

```bash
echo "=== AUD-032: Monitoring Stack Validation ===" | tee ./audit/logs/AUD-032.log

echo "# Monitoring Stack Validation" > ./audit/findings/AUD-032-monitoring.md

# Prometheus Health
echo "## Prometheus" >> ./audit/findings/AUD-032-monitoring.md
curl -sf http://localhost:9090/-/healthy >> ./audit/findings/AUD-032-monitoring.md 2>&1 || echo "FAILED" >> ./audit/findings/AUD-032-monitoring.md
echo "" >> ./audit/findings/AUD-032-monitoring.md

# Prometheus Targets
echo "### Prometheus Targets" >> ./audit/findings/AUD-032-monitoring.md
curl -s http://localhost:9090/api/v1/targets 2>/dev/null | python3 -c "
import json, sys
try:
    data = json.load(sys.stdin)
    active = [t for t in data['data']['activeTargets'] if t['health'] == 'up']
    print(f'Active Targets: {len(active)}/{len(data[\"data\"][\"activeTargets\"])}')
    for t in data['data']['activeTargets'][:10]:
        print(f\"  - {t['labels'].get('job', 'unknown')}: {t['health']}\")
except Exception as e:
    print(f'Prometheus API failed: {e}')
" >> ./audit/findings/AUD-032-monitoring.md 2>&1
echo "" >> ./audit/findings/AUD-032-monitoring.md

# Grafana Health
echo "## Grafana" >> ./audit/findings/AUD-032-monitoring.md
curl -sf http://localhost:3001/api/health >> ./audit/findings/AUD-032-monitoring.md 2>&1 || echo "FAILED" >> ./audit/findings/AUD-032-monitoring.md
echo "" >> ./audit/findings/AUD-032-monitoring.md

# Exporter Health
echo "## Exporters" >> ./audit/findings/AUD-032-monitoring.md
echo "### Postgres Exporter (9187)" >> ./audit/findings/AUD-032-monitoring.md
curl -sf http://localhost:9187/metrics 2>/dev/null | head -5 >> ./audit/findings/AUD-032-monitoring.md || echo "FAILED" >> ./audit/findings/AUD-032-monitoring.md
echo "" >> ./audit/findings/AUD-032-monitoring.md

echo "### Redis Exporter (9121)" >> ./audit/findings/AUD-032-monitoring.md
curl -sf http://localhost:9121/metrics 2>/dev/null | head -5 >> ./audit/findings/AUD-032-monitoring.md || echo "FAILED" >> ./audit/findings/AUD-032-monitoring.md
echo "" >> ./audit/findings/AUD-032-monitoring.md

echo "### cAdvisor (8080)" >> ./audit/findings/AUD-032-monitoring.md
curl -sf http://localhost:8080/metrics 2>/dev/null | head -5 >> ./audit/findings/AUD-032-monitoring.md || echo "FAILED" >> ./audit/findings/AUD-032-monitoring.md
echo "" >> ./audit/findings/AUD-032-monitoring.md

echo "### Node Exporter (9100)" >> ./audit/findings/AUD-032-monitoring.md
curl -sf http://localhost:9100/metrics 2>/dev/null | head -5 >> ./audit/findings/AUD-032-monitoring.md || echo "FAILED" >> ./audit/findings/AUD-032-monitoring.md
echo "" >> ./audit/findings/AUD-032-monitoring.md

# Container Status
echo "## Monitoring Containers" >> ./audit/findings/AUD-032-monitoring.md
docker ps --filter "name=agentic-prometheus" --filter "name=agentic-grafana" --filter "name=exporter" --filter "name=cadvisor" --format "table {{.Names}}\t{{.Status}}" >> ./audit/findings/AUD-032-monitoring.md 2>&1

# TIER 2: Detailed Analysis Report
cat > ./audit/reports/AUD-032-monitoring-report.md << 'REPORT_EOF'
# Monitoring Stack Validation - Detailed Analysis Report

**Agent ID:** AUD-032
**Category:** Production Readiness
**Generated:** $(date -u +%Y-%m-%dT%H:%M:%SZ)

## Summary
Comprehensive validation of monitoring infrastructure including Prometheus, Grafana, and exporters (Postgres, Redis, cAdvisor, Node).

## Priority & Risk
- **Priority:** P1 (Monitoring is critical for production operations)
- **Risk Level:** High (Missing monitoring = blind production operations)
- **Urgency:** Immediate (Required before production deployment)

## Key Findings
1. Prometheus health and target status
2. Grafana dashboard availability
3. Exporter operational status (Postgres 9187, Redis 9121, cAdvisor 8080, Node 9100)
4. Container health for monitoring stack components

## Evidence
- Reference: `./audit/findings/AUD-032-monitoring.md`

## Impact Analysis
Monitoring stack operational status directly impacts ability to observe platform health, detect issues, and maintain SLAs in production.

## Recommendations
1. **Ensure all exporters operational** (Effort: 0.5 days, Priority: P1)
2. **Validate Prometheus targets** (Effort: 0.5 days, Priority: P1)
3. **Configure Grafana dashboards** (Effort: 1 day, Priority: P2)
4. **Set up alerting rules** (Effort: 1 day, Priority: P1)

## Dependencies
- Requires: Prometheus, Grafana, exporters installed
- Blocks: Production deployment, SLA monitoring
REPORT_EOF

echo "Report created: ./audit/reports/AUD-032-monitoring-report.md" >> ./audit/logs/AUD-032.log
```

**Analyze:** Validate all monitoring components operational, metrics flowing to Prometheus, Grafana dashboards accessible.

---

### AUD-033: Security Hardening Validation

**Execute:**

```bash
echo "=== AUD-033: Security Hardening ===" | tee ./audit/logs/AUD-033.log

echo "# Security Hardening Status" > ./audit/findings/AUD-033-security-hardening.md

# Check SSL Certificates
echo "## SSL/TLS Certificates" >> ./audit/findings/AUD-033-security-hardening.md
if [ -d "./platform/ssl" ]; then
  ls -lh ./platform/ssl/ >> ./audit/findings/AUD-033-security-hardening.md
  echo "" >> ./audit/findings/AUD-033-security-hardening.md
  openssl x509 -in ./platform/ssl/certificate.crt -noout -text 2>&1 | grep -E "(Subject:|Issuer:|Not After)" >> ./audit/findings/AUD-033-security-hardening.md || echo "No certificate found" >> ./audit/findings/AUD-033-security-hardening.md
else
  echo "SSL directory not found" >> ./audit/findings/AUD-033-security-hardening.md
fi
echo "" >> ./audit/findings/AUD-033-security-hardening.md

# Check Security Documentation
echo "## Security Documentation" >> ./audit/findings/AUD-033-security-hardening.md
[ -f "./platform/SECURITY.md" ] && echo " SECURITY.md exists ($(wc -l < ./platform/SECURITY.md) lines)" >> ./audit/findings/AUD-033-security-hardening.md || echo " SECURITY.md missing" >> ./audit/findings/AUD-033-security-hardening.md
echo "" >> ./audit/findings/AUD-033-security-hardening.md

# Check Security Scripts
echo "## Security Scripts" >> ./audit/findings/AUD-033-security-hardening.md
[ -f "./platform/security-harden.sh" ] && echo " security-harden.sh exists" >> ./audit/findings/AUD-033-security-hardening.md || echo " security-harden.sh missing" >> ./audit/findings/AUD-033-security-hardening.md
[ -f "./platform/security-audit.sh" ] && echo " security-audit.sh exists" >> ./audit/findings/AUD-033-security-hardening.md || echo " security-audit.sh missing" >> ./audit/findings/AUD-033-security-hardening.md
echo "" >> ./audit/findings/AUD-033-security-hardening.md

# Check PostgreSQL RBAC
echo "## PostgreSQL RBAC" >> ./audit/findings/AUD-033-security-hardening.md
docker exec agentic-postgres psql -U postgres -c "\du" >> ./audit/findings/AUD-033-security-hardening.md 2>&1 || echo "Failed to check roles" >> ./audit/findings/AUD-033-security-hardening.md
echo "" >> ./audit/findings/AUD-033-security-hardening.md

# Check Environment Variables
echo "## Environment Security" >> ./audit/findings/AUD-033-security-hardening.md
[ -f "./platform/.env" ] && echo " .env file exists" >> ./audit/findings/AUD-033-security-hardening.md || echo "  .env file not found" >> ./audit/findings/AUD-033-security-hardening.md
[ -f "./platform/.env.example" ] && echo " .env.example exists" >> ./audit/findings/AUD-033-security-hardening.md || echo "  .env.example not found" >> ./audit/findings/AUD-033-security-hardening.md

# TIER 2: Detailed Analysis Report
cat > ./audit/reports/AUD-033-security-hardening-report.md << 'REPORT_EOF'
# Security Hardening Validation - Detailed Analysis Report

**Agent ID:** AUD-033
**Category:** Production Readiness
**Generated:** $(date -u +%Y-%m-%dT%H:%M:%SZ)

## Summary
Validation of security hardening measures including SSL/TLS certificates, security documentation, RBAC implementation, and environment variable security.

## Priority & Risk
- **Priority:** P1 (Security is non-negotiable for production)
- **Risk Level:** Critical (Security vulnerabilities can compromise entire platform)
- **Urgency:** Immediate (Must be in place before production deployment)

## Key Findings
1. SSL/TLS certificate status and validity
2. Security documentation presence (SECURITY.md)
3. Security automation scripts (security-harden.sh, security-audit.sh)
4. PostgreSQL RBAC role configuration
5. Environment variable security (.env, .env.example)

## Evidence
- Reference: `./audit/findings/AUD-033-security-hardening.md`

## Impact Analysis
Security hardening status determines production readiness and compliance with security best practices. Missing hardening measures expose platform to attacks.

## Recommendations
1. **Generate SSL/TLS certificates** (Effort: 0.5 days, Priority: P1)
2. **Implement PostgreSQL RBAC** (Effort: 1 day, Priority: P1)
3. **Create security automation scripts** (Effort: 1 day, Priority: P2)
4. **Document security procedures** (Effort: 0.5 days, Priority: P2)

## Dependencies
- Requires: SSL certificate authority, PostgreSQL access
- Blocks: Production deployment, security compliance
REPORT_EOF

echo "Report created: ./audit/reports/AUD-033-security-hardening-report.md" >> ./audit/logs/AUD-033.log
```

**Analyze:** Validate SSL configured, RBAC roles created, security scripts present, environment variables secured.

---

### AUD-034: Performance Optimization Validation

**Execute:**

```bash
echo "=== AUD-034: Performance Optimization ===" | tee ./audit/logs/AUD-034.log

echo "# Performance Optimization Status" > ./audit/findings/AUD-034-performance.md

# Check Performance Documentation
echo "## Documentation" >> ./audit/findings/AUD-034-performance.md
[ -f "./platform/PERFORMANCE.md" ] && echo " PERFORMANCE.md exists ($(wc -l < ./platform/PERFORMANCE.md) lines)" >> ./audit/findings/AUD-034-performance.md || echo " PERFORMANCE.md missing" >> ./audit/findings/AUD-034-performance.md
echo "" >> ./audit/findings/AUD-034-performance.md

# Check Performance Script
[ -f "./platform/optimize-performance.sh" ] && echo " optimize-performance.sh exists" >> ./audit/findings/AUD-034-performance.md || echo " optimize-performance.sh missing" >> ./audit/findings/AUD-034-performance.md
echo "" >> ./audit/findings/AUD-034-performance.md

# Database Indexes
echo "## Database Indexes" >> ./audit/findings/AUD-034-performance.md
docker exec agentic-postgres psql -U postgres agentic_platform -c "
SELECT schemaname, tablename, indexname
FROM pg_indexes
WHERE schemaname = 'mcp_documents'
ORDER BY tablename, indexname;
" >> ./audit/findings/AUD-034-performance.md 2>&1
echo "" >> ./audit/findings/AUD-034-performance.md

# PostgreSQL Configuration
echo "## PostgreSQL Tuning" >> ./audit/findings/AUD-034-performance.md
docker exec agentic-postgres psql -U postgres -c "
SELECT name, setting, unit
FROM pg_settings
WHERE name IN ('max_connections', 'shared_buffers', 'effective_cache_size', 'work_mem')
ORDER BY name;
" >> ./audit/findings/AUD-034-performance.md 2>&1
echo "" >> ./audit/findings/AUD-034-performance.md

# Redis Configuration
echo "## Redis Configuration" >> ./audit/findings/AUD-034-performance.md
docker exec agentic-redis redis-cli INFO memory 2>/dev/null | grep -E "(maxmemory|maxmemory_policy)" >> ./audit/findings/AUD-034-performance.md || echo "Failed to check Redis config" >> ./audit/findings/AUD-034-performance.md
echo "" >> ./audit/findings/AUD-034-performance.md

# Resource Usage
echo "## Container Resource Usage" >> ./audit/findings/AUD-034-performance.md
docker stats --no-stream --format "table {{.Name}}\t{{.CPUPerc}}\t{{.MemUsage}}" | head -16 >> ./audit/findings/AUD-034-performance.md 2>&1

# TIER 2: Detailed Analysis Report
cat > ./audit/reports/AUD-034-performance-report.md << 'REPORT_EOF'
# Performance Optimization Validation - Detailed Analysis Report

**Agent ID:** AUD-034
**Category:** Production Readiness
**Generated:** $(date -u +%Y-%m-%dT%H:%M:%SZ)

## Summary
Validation of performance optimization measures including database indexing, PostgreSQL tuning, Redis configuration, and container resource usage.

## Priority & Risk
- **Priority:** P2 (Performance impacts user experience and costs)
- **Risk Level:** Medium (Poor performance degrades UX and increases infrastructure costs)
- **Urgency:** Short-term (Should be addressed before scaling)

## Key Findings
1. Performance documentation status (PERFORMANCE.md)
2. Database index coverage
3. PostgreSQL tuning parameters (shared_buffers, work_mem, etc.)
4. Redis memory configuration
5. Container resource utilization

## Evidence
- Reference: `./audit/findings/AUD-034-performance.md`

## Impact Analysis
Performance optimization affects user experience, operational costs, and scalability. Proper tuning enables efficient resource usage and better response times.

## Recommendations
1. **Add missing database indexes** (Effort: 1 day, Priority: P2)
2. **Tune PostgreSQL parameters** (Effort: 0.5 days, Priority: P2)
3. **Configure Redis eviction policy** (Effort: 0.5 days, Priority: P3)
4. **Document performance baselines** (Effort: 0.5 days, Priority: P3)

## Dependencies
- Requires: Database access, container metrics
- Blocks: Performance SLAs, cost optimization
REPORT_EOF

echo "Report created: ./audit/reports/AUD-034-performance-report.md" >> ./audit/logs/AUD-034.log
```

**Analyze:** Validate indexes created, PostgreSQL tuned, Redis configured, resource usage optimized.

---

### AUD-035: Backup & Recovery Validation

**Execute:**

```bash
echo "=== AUD-035: Backup & Recovery ===" | tee ./audit/logs/AUD-035.log

echo "# Backup & Recovery Status" > ./audit/findings/AUD-035-backup.md

# Check Backup Scripts
echo "## Backup Scripts" >> ./audit/findings/AUD-035-backup.md
[ -f "./platform/backup.sh" ] && echo " backup.sh exists ($(wc -l < ./platform/backup.sh) lines)" >> ./audit/findings/AUD-035-backup.md || echo " backup.sh missing" >> ./audit/findings/AUD-035-backup.md
[ -f "./platform/restore.sh" ] && echo " restore.sh exists ($(wc -l < ./platform/restore.sh) lines)" >> ./audit/findings/AUD-035-backup.md || echo " restore.sh missing" >> ./audit/findings/AUD-035-backup.md
echo "" >> ./audit/findings/AUD-035-backup.md

# Check Script Executability
echo "## Script Permissions" >> ./audit/findings/AUD-035-backup.md
ls -l ./platform/backup.sh ./platform/restore.sh 2>&1 >> ./audit/findings/AUD-035-backup.md
echo "" >> ./audit/findings/AUD-035-backup.md

# Check Recent Backups
echo "## Recent Backups" >> ./audit/findings/AUD-035-backup.md
if [ -d "/tmp/story-portal-backups" ]; then
  ls -lht /tmp/story-portal-backups/ | head -5 >> ./audit/findings/AUD-035-backup.md
else
  echo "No backups directory found" >> ./audit/findings/AUD-035-backup.md
fi
echo "" >> ./audit/findings/AUD-035-backup.md

# WAL Archiving Status (PostgreSQL)
echo "## PostgreSQL WAL Archiving" >> ./audit/findings/AUD-035-backup.md
docker exec agentic-postgres psql -U postgres -c "SHOW wal_level;" >> ./audit/findings/AUD-035-backup.md 2>&1
docker exec agentic-postgres psql -U postgres -c "SHOW archive_mode;" >> ./audit/findings/AUD-035-backup.md 2>&1

# TIER 2: Detailed Analysis Report
cat > ./audit/reports/AUD-035-backup-report.md << 'REPORT_EOF'
# Backup & Recovery Validation - Detailed Analysis Report

**Agent ID:** AUD-035
**Category:** Production Readiness
**Generated:** $(date -u +%Y-%m-%dT%H:%M:%SZ)

## Summary
Validation of backup and recovery infrastructure including backup scripts, recent backups, and PostgreSQL WAL archiving configuration.

## Priority & Risk
- **Priority:** P1 (Data loss prevention is critical)
- **Risk Level:** Critical (No backups = catastrophic data loss risk)
- **Urgency:** Immediate (Must have backups before production)

## Key Findings
1. Backup script availability (backup.sh, restore.sh)
2. Script executability and permissions
3. Recent backup history
4. PostgreSQL WAL archiving configuration

## Evidence
- Reference: `./audit/findings/AUD-035-backup.md`

## Impact Analysis
Backup and recovery capability determines disaster recovery readiness. Without proper backups, data loss incidents become unrecoverable.

## Recommendations
1. **Create and test backup scripts** (Effort: 1 day, Priority: P1)
2. **Configure automated backups** (Effort: 0.5 days, Priority: P1)
3. **Enable PostgreSQL WAL archiving** (Effort: 0.5 days, Priority: P1)
4. **Test recovery procedures** (Effort: 1 day, Priority: P1)

## Dependencies
- Requires: Storage location for backups, PostgreSQL access
- Blocks: Production deployment, disaster recovery
REPORT_EOF

echo "Report created: ./audit/reports/AUD-035-backup-report.md" >> ./audit/logs/AUD-035.log
```

**Analyze:** Validate backup scripts exist and are executable, check backup history, verify WAL archiving configured.

---

### AUD-036: CI/CD Pipeline Validation

**Execute:**

```bash
echo "=== AUD-036: CI/CD Pipeline ===" | tee ./audit/logs/AUD-036.log

echo "# CI/CD Pipeline Status" > ./audit/findings/AUD-036-cicd.md

# Check GitHub Actions Workflow
echo "## GitHub Actions Workflow" >> ./audit/findings/AUD-036-cicd.md
if [ -f "./.github/workflows/platform-ci.yml" ]; then
  echo " platform-ci.yml exists ($(wc -l < ./.github/workflows/platform-ci.yml) lines)" >> ./audit/findings/AUD-036-cicd.md
  echo "" >> ./audit/findings/AUD-036-cicd.md
  echo "### Workflow Configuration:" >> ./audit/findings/AUD-036-cicd.md
  grep -E "(name:|on:|jobs:)" ./.github/workflows/platform-ci.yml >> ./audit/findings/AUD-036-cicd.md
else
  echo " platform-ci.yml missing" >> ./audit/findings/AUD-036-cicd.md
fi
echo "" >> ./audit/findings/AUD-036-cicd.md

# Check Integration Test Script
echo "## Integration Tests" >> ./audit/findings/AUD-036-cicd.md
[ -f "./platform/integration-test.sh" ] && echo " integration-test.sh exists" >> ./audit/findings/AUD-036-cicd.md || echo " integration-test.sh missing" >> ./audit/findings/AUD-036-cicd.md
echo "" >> ./audit/findings/AUD-036-cicd.md

# Check Load Test Script
echo "## Load Tests" >> ./audit/findings/AUD-036-cicd.md
[ -f "./platform/load-test.js" ] && echo " load-test.js exists" >> ./audit/findings/AUD-036-cicd.md || echo "  load-test.js not found" >> ./audit/findings/AUD-036-cicd.md

# TIER 2: Detailed Analysis Report
cat > ./audit/reports/AUD-036-cicd-report.md << 'REPORT_EOF'
# CI/CD Pipeline Validation - Detailed Analysis Report

**Agent ID:** AUD-036
**Category:** Production Readiness
**Generated:** $(date -u +%Y-%m-%dT%H:%M:%SZ)

## Summary
Validation of CI/CD pipeline infrastructure including GitHub Actions workflows, integration tests, and load testing capabilities.

## Priority & Risk
- **Priority:** P2 (CI/CD enables reliable deployments)
- **Risk Level:** Medium (Manual deployments are error-prone and slow)
- **Urgency:** Short-term (Should be in place before frequent deployments)

## Key Findings
1. GitHub Actions workflow configuration (platform-ci.yml)
2. Integration test script availability
3. Load testing script availability
4. Pipeline job configuration

## Evidence
- Reference: `./audit/findings/AUD-036-cicd.md`

## Impact Analysis
CI/CD pipeline determines deployment velocity and reliability. Automated testing catches issues before production deployment.

## Recommendations
1. **Create GitHub Actions workflow** (Effort: 1 day, Priority: P2)
2. **Implement integration tests** (Effort: 2 days, Priority: P2)
3. **Add load testing** (Effort: 1 day, Priority: P3)
4. **Configure automated deployments** (Effort: 1 day, Priority: P2)

## Dependencies
- Requires: GitHub repository, test infrastructure
- Blocks: Automated deployments, quality gates
REPORT_EOF

echo "Report created: ./audit/reports/AUD-036-cicd-report.md" >> ./audit/logs/AUD-036.log
```

**Analyze:** Validate CI/CD pipeline configured with all required jobs, integration tests present, load tests available.

---

### AUD-037: High Availability Architecture Review

**Execute:**

```bash
echo "=== AUD-037: High Availability ===" | tee ./audit/logs/AUD-037.log

echo "# High Availability Architecture" > ./audit/findings/AUD-037-ha.md

# Check HA Documentation
echo "## Documentation" >> ./audit/findings/AUD-037-ha.md
[ -f "./platform/HIGH-AVAILABILITY.md" ] && echo " HIGH-AVAILABILITY.md exists ($(wc -l < ./platform/HIGH-AVAILABILITY.md) lines)" >> ./audit/findings/AUD-037-ha.md || echo " HIGH-AVAILABILITY.md missing" >> ./audit/findings/AUD-037-ha.md
echo "" >> ./audit/findings/AUD-037-ha.md

# Check HAProxy Configuration
echo "## HAProxy Configuration" >> ./audit/findings/AUD-037-ha.md
if [ -f "./platform/haproxy.cfg" ]; then
  echo " haproxy.cfg exists ($(wc -l < ./platform/haproxy.cfg) lines)" >> ./audit/findings/AUD-037-ha.md
  echo "" >> ./audit/findings/AUD-037-ha.md
  echo "### HAProxy Frontends:" >> ./audit/findings/AUD-037-ha.md
  grep -E "^frontend" ./platform/haproxy.cfg >> ./audit/findings/AUD-037-ha.md 2>/dev/null || echo "No frontends found" >> ./audit/findings/AUD-037-ha.md
  echo "" >> ./audit/findings/AUD-037-ha.md
  echo "### HAProxy Backends:" >> ./audit/findings/AUD-037-ha.md
  grep -E "^backend" ./platform/haproxy.cfg >> ./audit/findings/AUD-037-ha.md 2>/dev/null || echo "No backends found" >> ./audit/findings/AUD-037-ha.md
else
  echo " haproxy.cfg missing" >> ./audit/findings/AUD-037-ha.md
fi
echo "" >> ./audit/findings/AUD-037-ha.md

# Check for HA Compose File
echo "## HA Deployment" >> ./audit/findings/AUD-037-ha.md
[ -f "./platform/docker-compose.ha.yml" ] && echo " docker-compose.ha.yml exists" >> ./audit/findings/AUD-037-ha.md || echo "  docker-compose.ha.yml not configured yet" >> ./audit/findings/AUD-037-ha.md
echo "" >> ./audit/findings/AUD-037-ha.md

# Check Container Replicas
echo "## Current Replicas" >> ./audit/findings/AUD-037-ha.md
docker ps --format "table {{.Names}}\t{{.Image}}" | grep -E "(l09|l12|platform-ui)" >> ./audit/findings/AUD-037-ha.md 2>/dev/null || echo "Single instance deployment (no HA active)" >> ./audit/findings/AUD-037-ha.md

# TIER 2: Detailed Analysis Report
cat > ./audit/reports/AUD-037-ha-report.md << 'REPORT_EOF'
# High Availability Architecture - Detailed Analysis Report

**Agent ID:** AUD-037
**Category:** Production Readiness
**Generated:** $(date -u +%Y-%m-%dT%H:%M:%SZ)

## Summary
Review of high availability architecture including HAProxy configuration, HA deployment setup, and service replication status.

## Priority & Risk
- **Priority:** P2 (HA required for production uptime guarantees)
- **Risk Level:** High (Single points of failure cause complete outages)
- **Urgency:** Medium-term (Required before production SLA commitments)

## Key Findings
1. HA documentation status (HIGH-AVAILABILITY.md)
2. HAProxy configuration for load balancing
3. HA deployment configuration (docker-compose.ha.yml)
4. Current service replica count

## Evidence
- Reference: `./audit/findings/AUD-037-ha.md`

## Impact Analysis
High availability architecture determines system uptime and resilience to failures. Without HA, single component failures cause complete service outages.

## Recommendations
1. **Document HA architecture** (Effort: 1 day, Priority: P2)
2. **Configure HAProxy for load balancing** (Effort: 2 days, Priority: P2)
3. **Create HA deployment configuration** (Effort: 1 day, Priority: P2)
4. **Deploy service replicas** (Effort: 1 day, Priority: P2)

## Dependencies
- Requires: Load balancer, orchestration platform
- Blocks: Production SLA guarantees, uptime commitments
REPORT_EOF

echo "Report created: ./audit/reports/AUD-037-ha-report.md" >> ./audit/logs/AUD-037.log
```

**Analyze:** Validate HA architecture documented, HAProxy configured, replicas planned or deployed.

---

## PHASE 7: CONSOLIDATION

After completing all agent executions, consolidate findings.

### AUD-001: Orchestrator - Final Consolidation

**Execute consolidation:**

```bash
echo "=== CONSOLIDATION PHASE ===" | tee ./audit/logs/consolidation.log

# Create consolidated directory
mkdir -p ./audit/consolidated

# Generate timestamp
TIMESTAMP=$(date -u +%Y-%m-%dT%H:%M:%SZ)

echo "Consolidation started at $TIMESTAMP" >> ./audit/logs/consolidation.log
```

**Create Executive Summary:**

Read ALL files in `./audit/findings/` and `./audit/reports/` and create:

1. **`./audit/consolidated/EXECUTIVE-SUMMARY.md`**
   - Total findings count by severity (Critical, High, Medium, Low)
   - Service health summary
   - Top 10 priority issues
   - Key metrics dashboard

2. **`./audit/consolidated/V2-SPECIFICATION-INPUTS.md`** (MAIN DELIVERABLE)
   Structure:
   ```markdown
   # V2 Specification Inputs

   ## 1. Infrastructure Requirements
   [From AUD-019, AUD-020, AUD-021, AUD-022]

   ## 2. Security Requirements
   [From AUD-002, AUD-014, AUD-023, AUD-024]

   ## 3. Data Layer Requirements
   [From AUD-004, AUD-015, AUD-017]

   ## 4. API & Integration Requirements
   [From AUD-005, AUD-016, AUD-018]

   ## 5. Quality & Testing Requirements
   [From AUD-003, AUD-006, AUD-007]

   ## 6. UX & DevEx Requirements
   [From AUD-008, AUD-009]

   ## 7. Service Discovery Findings
   [From AUD-010, AUD-011, AUD-012, AUD-013]

   ## 8. V2 Platform Components (NEW)
   [From AUD-025 (L09 Gateway), AUD-026 (L12 Service Hub), AUD-027 (Platform UI),
    AUD-028 (nginx), AUD-029 (UI-Backend Integration)]

   ## 9. Documentation Status
   [From AUD-030]

   ## 10. External Dependencies
   [From AUD-031]

   ## 11. Priority Matrix

   | Priority | Category | Finding | Recommended Action |
   |----------|----------|---------|-------------------|
   | P1 | ... | ... | ... |

   ## 12. Implementation Roadmap

   ### Phase 1: Critical Fixes (Week 1-2)
   ### Phase 2: High Priority (Week 3-4)
   ### Phase 3: Medium Priority (Week 5-8)
   ### Phase 4: Low Priority/Enhancements (Week 9+)
   ```

3. **`./audit/consolidated/FULL-AUDIT-REPORT.md`**
   - Complete findings from all agents
   - Detailed analysis
   - Evidence references

4. **`./audit/consolidated/priority-matrix.md`**
   - All findings sorted by priority
   - Effort estimates
   - Dependencies

5. **`./audit/consolidated/implementation-roadmap.md`**
   - Phased implementation plan
   - Resource requirements
   - Risk mitigation

---

## COMPLETION

When all phases complete:

```bash
echo "=== AUDIT COMPLETE ===" | tee -a ./audit/logs/audit.log
echo "Completed at $(date)" >> ./audit/logs/audit.log

# Summary
echo ""
echo "=============================================="
echo "  AUDIT COMPLETE"
echo "=============================================="
echo ""
echo "Results saved to: ./audit/"
echo ""
echo "Key deliverables:"
echo "  - ./audit/consolidated/V2-SPECIFICATION-INPUTS.md"
echo "  - ./audit/consolidated/EXECUTIVE-SUMMARY.md"
echo "  - ./audit/consolidated/FULL-AUDIT-REPORT.md"
echo ""
echo "Individual findings: ./audit/findings/"
echo "Individual reports: ./audit/reports/"
echo "Logs: ./audit/logs/"
echo ""
```

**Present the consolidated files to the user for download.**

---

## ERROR RECOVERY

If any phase fails:
1. Log the error
2. Save partial results
3. Continue with next agent
4. Report failures in final summary

Never stop completely - always produce partial results.
